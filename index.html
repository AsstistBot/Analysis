<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Analyse eines Discord-Servers mit Mitgliederstatistiken und Diagramm">
    <title>Discord Server Analyse</title>
    <style>
        :root {
            --primary-bg: #121215;
            --accent-color: #ea3131;
            --text-color: #e0e0e0;
            --card-bg: rgba(234, 49, 49, 0.06);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --blur: blur(10px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--primary-bg), rgb(120, 54, 54));
            color: var(--text-color);
            min-height: 100vh;
            display: grid;
            place-items: center;
            padding: 1rem;
            position: relative;
            overflow-x: hidden;
            color-scheme: dark;
        }

        #particle-canvas {
            position: fixed;
            inset: 0;
            z-index: -1;
            opacity: 0.4;
        }

        main {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 900px;
            width: 100%;
            box-shadow: var(--shadow);
            backdrop-filter: var(--blur);
            transition: transform 0.3s ease;
            animation: fadeIn 1.2s ease-out;
        }

        main:hover {
            transform: translateY(-5px);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: #ffffff;
            text-align: center;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .info-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            text-align: center;
            transition: transform 0.3s ease;
            animation: slideIn 1.4s ease-out;
        }

        .info-box:hover {
            transform: scale(1.02);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .info-box p {
            font-size: clamp(1rem, 3vw, 1.25rem);
            margin: 0.5rem 0;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 0.75rem;
            aspect-ratio: 16 / 9;
            animation: slideIn 1.6s ease-out;
        }

        canvas {
            max-width: 100%;
            height: auto;
        }

        .error {
            color: #ff5555;
            text-align: center;
            margin-top: 1.5rem;
            font-size: 1.1rem;
        }

        .last-update-box {
            position: fixed;
            top: 1rem;
            left: 1rem;
            background: rgba(234, 49, 49, 0.2);
            border-radius: 0.5rem;
            padding: 0.75rem;
            font-size: 0.9rem;
            color: #ffffff;
            box-shadow: var(--shadow);
            backdrop-filter: var(--blur);
            transition: transform 0.3s ease;
            animation: fadeIn 1s ease-out;
        }

        .last-update-box:hover {
            transform: scale(1.05);
        }

        @media (max-width: 600px) {
            main {
                padding: 1.5rem;
            }

            h1 {
                font-size: clamp(1.5rem, 4vw, 2rem);
            }

            .info-box p {
                font-size: 0.9rem;
            }

            .last-update-box {
                font-size: 0.8rem;
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <canvas id="particle-canvas" aria-hidden="true"></canvas>
    <div class="last-update-box" id="last-update" aria-live="polite">
        Stand: Lade...
    </div>
    <main aria-labelledby="main-title">
        <h1 id="main-title">Discord Server Analyse</h1>
        <section class="info-box" aria-labelledby="server-info">
            <p id="server-name" aria-live="polite">Lade Servername...</p>
            <p id="member-count" aria-live="polite">Aktuelle Mitglieder: <span id="count">0</span></p>
        </section>
        <section class="chart-container" aria-labelledby="chart-title">
            <h2 id="chart-title" class="sr-only">Mitgliederentwicklung</h2>
            <canvas id="memberChart" role="img" aria-label="Diagramm der Mitgliederentwicklung über die Zeit"></canvas>
        </section>
        <p id="error" class="error" aria-live="assertive"></p>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script>
        // Partikel-Animation
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d', { alpha: true });
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const particles = [];
        const particleCount = 100;

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2 + 1;
                this.speedX = Math.random() * 0.5 - 0.25;
                this.speedY = Math.random() * 0.5 - 0.25;
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
                if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
            }

            draw() {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initParticles() {
            for (let i = 0; i < particleCount; i++) {
                particles.push(new Particle());
            }
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (const particle of particles) {
                particle.update();
                particle.draw();
            }
            requestAnimationFrame(animateParticles);
        }

        initParticles();
        animateParticles();

        // Count-Up-Animation
        function countUp(target, elementId, duration) {
            const element = document.getElementById(elementId);
            let current = 0;
            const increment = target / (duration / 16);
            function updateCount() {
                current += increment;
                if (current >= target) {
                    element.textContent = Math.floor(target);
                    return;
                }
                element.textContent = Math.floor(current);
                requestAnimationFrame(updateCount);
            }
            updateCount();
        }

        // Discord API
        async function fetchDiscordServerInfo() {
            const inviteCode = 'nrwnet'; // Ersetze bei Bedarf mit einem gültigen Invite-Code
            const apiUrl = `https://discord.com/api/v10/invites/${inviteCode}?with_counts=true`;

            try {
                const response = await fetch(apiUrl, { cache: 'no-store' });
                if (!response.ok) throw new Error('Fehler beim Abrufen der Serverinformationen');
                const data = await response.json();

                const serverName = document.getElementById('server-name');
                const countElement = document.getElementById('count');
                const lastUpdate = document.getElementById('last-update');

                serverName.textContent = `Server: ${data.guild.name || 'Unbekannt'}`;
                const memberCount = data.approximate_member_count || 0;
                countUp(memberCount, 'count', 2000);

                const currentDate = new Date().toLocaleDateString('de-DE', {
                    day: '2-digit',
                    month: 'long',
                    year: 'numeric'
                });
                lastUpdate.textContent = `Stand: ${currentDate}`;

                updateChart(memberCount);
            } catch (error) {
                const errorElement = document.getElementById('error');
                errorElement.textContent = `Fehler: ${error.message}. Ist der Invite-Link gültig?`;
                document.getElementById('server-name').textContent = 'Server: Nicht verfügbar';
                document.getElementById('count').textContent = '0';
                document.getElementById('last-update').textContent = 'Stand: Nicht verfügbar';
            }
        }

        // Chart.js
        function updateChart(currentMembers) {
            const ctx = document.getElementById('memberChart').getContext('2d');
            const labels = [
                'Mai 2024', 'Jun 2024', 'Jul 2024', 'Aug 2024', 'Sep 2024',
                'Okt 2024', 'Nov 2024', 'Dez 2024', 'Jan 2025', 'Feb 2025',
                'Mär 2025', 'Apr 2025', 'Mai 2025'
            ];
            const data = [
                1000, 1100, 1150, 1200, 1300, 1350, 1400, 1450, 1500,
                1600, 1700, 1800, currentMembers || 1900
            ];

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Mitgliederzahl',
                        data,
                        borderColor: 'rgba(234, 49, 49, 0.8)',
                        backgroundColor: 'rgba(234, 49, 49, 0.2)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: 'rgba(234, 49, 49, 0.8)',
                        pointHoverBackgroundColor: '#ffffff',
                        pointHoverBorderColor: 'rgba(234, 49, 49, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Mitglieder',
                                color: 'var(--text-color)',
                                font: { size: 14 }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: 'var(--text-color)' }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Zeit',
                                color: 'var(--text-color)',
                                font: { size: 14 }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: 'var(--text-color)' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: 'var(--text-color)', font: { size: 14 } }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // Event Listener
        window.addEventListener('load', fetchDiscordServerInfo);
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
